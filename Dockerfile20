# Adapted from 
FROM credocker/creinstall:2020.0
MAINTAINER Michael Kahle <michael.kahle@yahoo.de>

ARG BUILD_YEAR=2020
ARG BUILD_MONTH=0
ARG BUILD_TAG=2020.0

#ENV DEBIAN_FRONTEND noninteractive
#ENV INITRD No
#ENV LANG en_US.UTF-8

#ENV JAVA_FAMILY open
ENV ASSETS_VERSION 2020.0
#ENV KOTLIN_VERSION 1.8.0
#ENV BUILD_SYSTEM maven
#ENV GRADLE_VERSION 7.6
#ENV MAVEN_VERSION 3.9.0

LABEL Name="Assets for CRE" \
      CRE=$CRE_VERSION \ 
      Year=$BUILD_YEAR \
      Month=$BUILD_MONTH \
      Version=$ASSETS_VERSION \
      OS="Ubuntu:$UBUNTU_VERSION" \
      Build_=$BUILD_TAG 

COPY cre /cre
WORKDIR "/cre/node"
#Install js,css via npm

RUN npm config list

RUN npm config set init-author-name "jaketrent"
RUN npm config set init-author-email "your-email@example.com"
RUN npm config set init-author-url  "https://my-domain/user"
RUN npm config set init-version 0.0.2
RUN npm config set init-license "MIT"
RUN npm init -y

RUN npm install jquery
RUN npm install vue vuex axios 
#RUN npm install primevue primeicons
RUN npm install leaflet
RUN npm install ol
RUN npm install d3

RUN npm-install-peers

RUN npm root -g
RUN npm list -g 
RUN npm root
RUN npm list 

#RUN ls -l -a /cre/node/
RUN ls -l -a /cre/node/.npm-global
RUN ls -l -a /cre/node/.npm-global/lib
RUN ls -l -a /cre/node/.npm-global/lib/node_modules

COPY cre /cre
RUN mkdir -p /cre && touch /cre/versions.txt && \ 
    echo "$(date +'%F %R') \t creAssets \t ${ASSETS_VERSION}" >> /cre/versions.txt && \
    echo "$(date +'%F %R') \t  $(npm list jquery | grep jquery)" >> /cre/versions.txt
 
WORKDIR "/cre/assets"
#EXPOSE 8080 

ENTRYPOINT ["/cre/assets-entrypoint.sh"]

CMD ["shoreman", "/cre/assets-procfile"]
